const bot = BotManager.getCurrentBot();

const JSOUP = Packages.org.jsoup.Jsoup;
const URLDecoder = Packages.java.net.URLDecoder;

const MESSAGE_PREFIX = '/';
const API_URL = "http://ec2-3-34-171-56.ap-northeast-2.compute.amazonaws.com:3000/api";

/**
 * (string) msg.content: 메시지의 내용
 * (string) msg.room: 메시지를 받은 방 이름
 * (User) msg.author: 메시지 전송자
 * (string) msg.author.name: 메시지 전송자 이름
 * (Image) msg.author.avatar: 메시지 전송자 프로필 사진
 * (string) msg.author.avatar.getBase64()
 * (string | null) msg.author.hash: 사용자의 고유 id
 * (boolean) msg.isGroupChat: 단체/오픈채팅 여부
 * (boolean) msg.isDebugRoom: 디버그룸에서 받은 메시지일 시 true
 * (string) msg.packageName: 메시지를 받은 메신저의 패키지명
 * (void) msg.reply(string): 답장하기
 * (boolean) msg.isMention: 메세지 맨션 포함 여부
 * (bigint) msg.logId: 각 메세지의 고유 id
 * (bigint) msg.channelId: 각 방의 고유 id
 */
function onMessage(msg) {
    const vsRegex = /\s*vs\s*/gi;

    if(vsRegex.test(msg.content)) {
        let items = msg.content.split(/\s*vs\s*/gi);
        let trimmedItems = items.map(function(item) {
            return item.trim();
        });
        let validItems = trimmedItems.filter(function(item) {
            return item.length > 0;
        });

        if(validItems.length > 0) {
            const randomVsIndex = Math.floor(Math.random() * validItems.length);
            msg.reply(validItems[randomVsIndex]);
        }
    }

    if(!msg.content.startsWith(MESSAGE_PREFIX)) return;

    let message = "";
    let messageData = "";

    try {
        const command = msg.content.substring(MESSAGE_PREFIX.length).trim();
        const featString = command.split(/\s+/)[0];
        const options = command.split(/\s+/).slice(1);
        if(stringMatchResult(featString, ["타일런트시뮬", "타일런트", "ㅌㅇㄾㅅㅁ", "ㅌㅇㄾ", "ㅌㅇㄹㅌ", "ㅌㅇㄹㅌㅅㅁ"])) {
            message = "";
            let queryString = buildQueryString(options);

            let superialData = callApi("/enforcements/superial", queryString);
            message += superialData.resultRaw;
            msg.reply(message);
        }

        if(stringMatchResult(featString, ["스타포스시뮬", "ㅅㅌㅍㅅㅅㅁ"])) {
            message = "";
            let queryString = buildQueryString(options);

            let starForceData = callApi("/enforcements/starForce", queryString);
            message += starForceData.resultRaw;
            msg.reply(message);
        }

        if(stringMatchResult(featString, ["ㅎㅅ", "히스토리", "히스"])) {
            message = "명령어 실행 결과: 성공\n";
            messageData = "";

            let queryString = buildQueryString(msg.room, msg.author.name, options);

            let expData = callApi("/history/exp", queryString);
            messageData += `\n${expData.resultRaw}\n\n---------------------\n`;

            let levelData = callApi("/history/level", queryString);
            messageData += `\n${levelData.resultRaw}`;

            message += messageData;
            msg.reply(message);
        }

        if(stringMatchResult(featString, ["ㅂㅋ", "본캐"])) {
            message = "명령어 실행 결과: 성공\n";
            messageData = "";

            let queryString = buildQueryString(msg.room, msg.author.name, options);
            let mainCharacterData;

            if(!options || options.length < 1) {
                mainCharacterData = callApi("/main_character/get", queryString);
            } else {
                mainCharacterData = callApi("/main_character/set", queryString);
            }

            messageData += `\n${mainCharacterData.resultRaw}`;

            message += messageData;
            msg.reply(message);
        }

        if(stringMatchResult(featString, ["ㅁㅁㅈ", "뭐먹지"])) {
            const foodList = [
                "김치찌개", "된장찌개", "부대찌개", "순두부찌개", "청국장찌개",
                "비빔밥", "돌솥비빔밥", "불고기", "갈비", "삼겹살",
                "목살", "항정살", "가브리살", "치킨", "후라이드치킨",
                "양념치킨", "간장치킨", "마늘치킨", "파닭", "찜닭",
                "닭갈비", "닭볶음탕", "백숙", "삼계탕", "피자",
                "햄버거", "치즈버거", "불고기버거", "새우버거", "치킨버거",
                "파스타", "까르보나라", "알리오올리오", "토마토파스타", "크림파스타",
                "스테이크", "등심스테이크", "안심스테이크", "립아이스테이크", "채끝스테이크",
                "초밥", "회", "광어회", "우럭회", "연어회",
                "참치회", "물회", "회덮밥", "알밥", "장어덮밥",
                "라면", "짜파게티", "불닭볶음면", "신라면", "진라면",
                "안성탕면", "너구리", "짬뽕라면", "김치라면", "우동",
                "메밀소바", "냉우동", "온우동", "쫄면", "비빔국수",
                "잔치국수", "칼국수", "수제비", "만두", "왕만두",
                "물만두", "군만두", "찐만두", "김치만두", "고기만두",
                "짜장면", "짬뽕", "탕수육", "울면", "유산슬",
                "깐풍기", "라조기", "양장피", "팔보채", "마파두부",
                "중국집볶음밥", "짬짜면", "간짜장", "삼선짜장", "삼선짬뽕",
                "쌀국수", "월남쌈", "분짜", "반미", "똠얌꿍",
                "팟타이", "카오팟", "쏨땅", "팟카파오", "그린커리",
                "레드커리", "옐로우커리", "똠카가이", "카레", "돈카츠",
                "치즈돈카츠", "등심돈카츠", "안심돈카츠", "생선까스", "고구마돈카츠",
                "함박스테이크", "오므라이스", "하이라이스", "나폴리탄", "타코야키",
                "오코노미야키", "야키소바", "라멘", "돈코츠라멘", "미소라멘",
                "쇼유라멘", "시오라멘", "츠케멘", "규동", "오야코동",
                "덴동", "가츠동", "우나기동", "텐동", "김밥",
                "참치김밥", "치즈김밥", "불고기김밥", "야채김밥", "충무김밥",
                "누드김밥", "유부초밥", "떡볶이", "라볶이", "쫄볶이",
                "치즈떡볶이", "해물떡볶이", "로제떡볶이", "순대", "야채순대",
                "찹쌀순대", "오뎅", "어묵", "핫도그", "치즈핫도그",
                "감자핫도그", "떡갈비", "돼지갈비", "소갈비", "LA갈비",
                "양념갈비", "생갈비", "갈비탕", "설렁탕", "곰탕",
                "육개장", "추어탕", "감자탕", "뼈해장국", "선지해장국",
                "콩나물해장국", "북어해장국", "순대국", "내장탕", "족발",
                "보쌈", "막국수", "냉면", "물냉면", "비빔냉면",
                "회냉면", "쟁반냉면", "콩국수", "밀면", "국밥",
                "돼지국밥", "순대국밥", "따로국밥", "해물탕", "대구탕",
                "아귀찜", "해물찜", "갈치조림", "고등어조림", "동태찌개",
                "김치찜", "제육볶음", "두루치기", "오징어볶음", "낙지볶음",
                "쭈꾸미볶음", "낙곱새", "곱창", "막창", "대창",
                "염통", "양", "천엽", "간", "육회",
                "천엽회", "양회", "간회", "편육", "수육",
                "묵은지삼겹살", "오겹살", "차돌박이", "양념목살", "와규",
                "한우", "소고기", "돼지고기", "닭고기", "오리고기",
                "양고기", "삼치", "고등어", "꽁치", "갈치",
                "조기", "임연수어", "병어", "가자미", "도다리",
                "넙치", "우럭", "농어", "숭어", "참돔",
                "돌돔", "벵에돔", "감성돔", "방어", "부시리",
                "참치", "연어", "광어", "새우", "대하",
                "킹크랩", "대게", "홍게", "랍스터", "바닷가재",
                "전복", "소라", "문어", "주꾸미", "낙지",
                "쭈꾸미", "오징어", "갑오징어", "한치", "꼴뚜기",
                "멍게", "해삼", "성게", "굴", "바지락",
                "홍합", "키조개", "가리비", "멸치", "뱅어포",
                "쥐포", "오징어채", "김", "미역", "다시마",
                "파래", "매생이", "톳", "해초", "샐러드",
                "시저샐러드", "그린샐러드", "과일샐러드", "감자샐러드", "콥샐러드",
                "닭가슴살샐러드", "두부샐러드", "샌드위치", "클럽샌드위치", "BLT샌드위치",
                "에그샌드위치", "참치샌드위치", "치킨샌드위치", "햄치즈샌드위치", "베이글",
                "크로와상", "스콘", "머핀", "도넛", "츄러스",
                "와플", "팬케이크", "프렌치토스트", "토스트", "식빵",
                "곡물빵", "호밀빵", "바게트", "시나몬롤", "단팥빵",
                "크림빵", "소보로빵", "치즈빵", "마늘빵", "옥수수빵",
                "찹쌀도넛", "꽈배기", "케이크", "초콜릿케이크", "치즈케이크",
                "티라미수", "마카롱", "에클레어", "타르트", "파이",
                "애플파이", "블루베리파이", "호박파이", "고구마파이", "브라우니",
                "쿠키", "초코칩쿠키", "버터쿠키", "마들렌", "휘낭시에",
                "카스테라", "약과", "한과", "유과", "강정",
                "다식", "정과", "숙실과", "과편", "엿",
                "호두과자", "찹쌀떡", "인절미", "송편", "경단",
                "시루떡", "증편", "절편", "개떡", "꿀떡",
                "밤떡", "쑥떡", "쑥개떡", "호박떡", "수수팥떡",
                "약식", "두텁떡", "화전", "주악", "빙수",
                "팥빙수", "과일빙수", "녹차빙수", "초코빙수", "망고빙수",
                "딸기빙수", "눈꽃빙수", "설빙", "아이스크림", "바닐라아이스크림",
                "초콜릿아이스크림", "딸기아이스크림", "민트초코아이스크림", "젤라또", "소프트아이스크림",
                "콘아이스크림", "바아이스크림", "쿠키앤크림", "초코칩", "캐러멜",
                "버터스카치", "피스타치오", "헤이즐넛", "블루베리", "딸기",
                "바나나", "망고", "복숭아", "수박", "참외",
                "멜론", "포도", "청포도", "샤인머스캣", "귤",
                "오렌지", "자몽", "레몬", "라임", "키위",
                "파인애플", "용과", "패션후르츠", "리치", "람부탄",
                "망고스틴", "두리안", "용안", "구아바", "파파야",
                "아보카도", "코코넛", "석류", "무화과", "대추",
                "감", "곶감", "밤", "호두", "땅콩",
                "아몬드", "캐슈넛", "마카다미아", "피칸", "잣",
                "해바라기씨", "호박씨", "건포도", "건망고", "건바나나",
                "말린과일", "견과류", "시리얼", "그래놀라", "오트밀",
                "콘프레이크", "뮤즐리", "요거트", "그릭요거트", "떠먹는요거트",
                "마시는요거트", "치즈", "모짜렐라치즈", "체다치즈", "고다치즈",
                "까망베르치즈", "브리치즈", "크림치즈", "파마산치즈", "블루치즈",
                "우유", "저지방우유", "무지방우유", "두유", "아몬드우유",
                "귀리우유", "코코넛밀크", "라떼", "카푸치노", "아메리카노",
                "에스프레소", "바닐라라떼", "카라멜라떼", "카페모카", "화이트모카",
                "녹차라떼", "홍차", "얼그레이", "캐모마일차", "페퍼민트차",
                "루이보스차", "국화차", "매실차", "유자차", "생강차",
                "대추차", "모과차", "오미자차", "쌍화차", "인삼차",
                "녹차", "홍차", "백차", "청차", "흑차",
                "보이차", "우롱차", "철관음", "보성녹차", "제주녹차",
                "말차", "주스", "오렌지주스", "사과주스", "포도주스",
                "토마토주스", "당근주스", "비트주스", "석류주스", "키위주스",
                "망고주스", "바나나주스", "딸기주스", "수박주스", "복숭아주스",
                "스무디", "딸기스무디", "바나나스무디", "망고스무디", "베리스무디",
                "그린스무디", "에이드", "레모네이드", "자몽에이드", "청포도에이드",
                "블루레모네이드", "유자에이드", "패션후르츠에이드", "탄산음료", "콜라",
                "사이다", "환타", "스프라이트", "밀키스", "칠성사이다",
                "펩시", "닥터페퍼", "마운틴듀", "이온음료", "포카리스웨트",
                "게토레이", "파워에이드", "비타500", "박카스", "핫식스",
                "레드불", "몬스터", "번인텐", "맥주", "소주",
                "막걸리", "동동주", "청주", "정종", "와인",
                "레드와인", "화이트와인", "로제와인", "스파클링와인", "샴페인",
                "위스키", "보드카", "럼", "진", "데킬라",
                "꼬냑", "브랜디", "리큐르", "칵테일", "모히토",
                "마가리타", "블러디메리", "진토닉", "롱아일랜드아이스티", "섹스온더비치",
                "블루하와이", "코스모폴리탄", "맨해튼", "말리부", "깔루아",
                "베일리스", "예거밤", "예거마이스터", "압생트", "삼부카",
                "리몬첼로", "아마레또", "캄파리", "아페롤", "베르무트",
                "샤또", "포도주", "복분자주", "매실주", "오미자주",
                "유자주", "레드향소주", "자몽소주", "청포도소주", "복숭아소주",
                "수박소주", "딸기소주", "블루베리소주", "망고소주", "석류소주",
                "레몬소주", "라임소주", "자두소주", "매실소주", "대나무숲",
                "새로", "참이슬", "처음처럼", "진로", "잎새주",
                "화요", "안동소주", "문배주", "이강주", "죽력고",
                "옥로주", "송순주", "두견주", "오가피주", "인삼주",
                "계피주", "생강주", "국화주", "송화주", "백세주",
                "홍삼주", "오미자주", "구기자주", "산수유주", "당귀주",
                "모과주", "감주", "도토리묵", "청포묵", "메밀묵",
                "노란묵", "흰묵", "검은묵", "우뭇가사리묵", "묵사발",
                "묵무침", "묵밥", "계란찜", "달걀찜", "달걀말이",
                "계란말이", "스크램블에그", "오믈렛", "에그베네딕트", "수란",
                "반숙란", "완숙란", "삶은달걀", "구운달걀", "계란후라이",
                "계란국", "계란탕", "계란죽", "장조림", "멸치볶음",
                "잔멸치볶음", "볶음김치", "김치볶음", "돼지고기김치볍음", "참치김치찌개",
                "고등어김치찌개", "오징어김치찌개", "꽁치김치찌개", "날치알주먹밥", "참치마요주먹밥",
                "김치주먹밥", "유부초밥주먹밥", "연어주먹밥", "명란주먹밥", "날치알",
                "명란젓", "창난젓", "어리굴젓", "오징어젓갈", "조개젓",
                "새우젓", "멸치젓", "갈치속젓", "황석어젓", "밴댕이젓",
                "감동젓", "꼴뚜기젓", "게장", "간장게장", "양념게장",
                "꽃게장", "돌게장", "새우장", "전복장", "오징어장",
                "마늘쫑장아찌", "깻잎장아찌", "고추장아찌", "무장아찌", "장아찌",
                "된장", "고추장", "쌈장", "청국장", "막장",
                "춘장", "굴소스", "어간장", "국간장", "진간장",
                "양조간장", "조선간장", "왜간장", "참기름", "들기름",
                "들깨가루", "깨소금", "후추", "마늘", "생강",
                "파", "대파", "쪽파", "양파", "마늘종",
                "마늘쫑", "부추", "미나리", "깻잎", "상추",
                "양상추", "치커리", "배추", "알배기배추", "얼갈이배추",
                "봄동", "무", "알타리무", "당근", "감자",
                "고구마", "밤고구마", "호박고구마", "자색고구마", "양념고구마",
                "애호박", "단호박", "늙은호박", "청양고추", "홍고추",
                "풋고추", "꽈리고추", "오이", "가지", "토마토",
                "방울토마토", "대추방울토마토", "찰토마토", "흑토마토", "피망",
                "파프리카", "브로콜리", "콜리플라워", "양배추", "적양배추",
                "케일", "시금치", "근대", "청경채", "갓",
                "냉이", "달래", "쑥", "도라지", "더덕",
                "우엉", "연근", "토란", "마", "칡",
                "콩나물", "숙주나물", "고사리", "취나물", "시래기",
                "열무", "갓김치", "총각김치", "파김치", "깍두기",
                "백김치", "동치미", "나박김치", "보쌈김치", "굴김치",
                "부추김치", "고들빼기김치", "물김치", "배추겉절이", "무생채",
                "도라지무침", "고사리나물", "취나물", "시래기나물", "콩나물무침",
                "숙주나물", "오이무침", "미역줄기볶음", "톳나물", "파래무침",
                "청포묵무침", "도토리묵무침", "마늘종볶음", "호박볶음", "가지볶음",
                "버섯볶음", "새송이버섯", "표고버섯", "느타리버섯", "팽이버섯",
                "양송이버섯", "목이버섯", "석이버섯", "송이버섯", "능이버섯",
                "싸리버섯", "만가닥버섯", "미니새송이", "만능간장", "쌈무",
                "단무지", "피클", "오이피클", "양파피클", "할라피뇨",
                "올리브", "케이퍼", "안초비", "카나페", "치즈볼",
                "핑거푸드", "에어프라이어요리", "전자레인지요리", "주먹고기", "전",
                "김치전", "파전", "부추전", "빈대떡", "녹두전",
                "동그랑땡", "화채", "수정과", "식혜", "미숫가루",
                "수박화채", "오미자화채", "복분자화채", "배숙", "생강차",
                "대추차", "곶감", "곶감말이", "약밥", "수삼",
                "홍삼", "엘릭서", "엘릭시르", "체력물약", "마나물약",
                "빨간포션", "주황포션", "하얀포션", "파란포션", "보라포션",
                "만병통치약", "알약", "알사탕", "옥수수", "군밤",
                "군고구마", "붕어빵", "호빵", "계란빵", "잉어빵",
                "국화빵", "호두과자", "찰떡", "호떡", "씨앗호떡",
                "견과류호떡", "찰보리빵", "보리빵", "밀빵", "옥수수빵",
                "고구마빵", "감자빵", "밤빵", "피자빵", "야채빵",
                "카레빵", "크림빵", "슈크림빵", "초코빵", "단팥빵",
                "팥빵", "호박빵", "밤양갱", "양갱", "단팥죽",
                "팥죽", "호박죽", "잣죽", "전복죽", "굴죽",
                "참치죽", "야채죽", "버섯죽", "닭죽", "삼계죽",
                "흑임자죽", "녹두죽", "율무죽", "미역죽", "카레라이스",
                "하이라이스", "오므라이스", "크림리조또", "토마토리조또", "해물리조또",
                "새우리조또", "버섯리조또", "치즈리조또", "리조또", "볶음밥",
                "김치볶음밥", "새우볶음밥", "베이컨볶음밥", "해물볶음밥", "야채볶음밥",
                "계란볶음밥", "소고기볶음밥", "치킨볶음밥", "참치볶음밥", "낙지볶음밥",
                "오징어볶음밥", "명란젓볶음밥", "명란볶음밥", "낙지젓볶음밥", "주먹밥",
                "쌀국수볶음", "월남쌈쌀국수", "분짜쌀국수", "똠카가이쌀국수", "팟씨이우",
                "카오닙", "카오쏭", "나시고렝", "미고렝", "사테",
                "렌당", "가도가도", "바비굴링", "나시짬뿌르", "바쏘",
                "삭삭", "루박", "텀푸",  "볶음우동", "나가사키짬뽕",
                "소바", "자루소바", "모리소바", "니신소바", "키츠네우동",
                "탄탄멘", "유린기", "동파육", "샤오롱바오", "교자",
                "춘권", "하카우", "딤섬", "완탕", "완탕면",
                "볶음당면", "잡채", "꼬치", "닭꼬치", "떡꼬치",
                "어묵꼬치", "소시지", "프랑크소시지", "비엔나소시지", "훈제소시지",
                "베이컨", "햄", "스팸", "런천미트", "콘비프"
            ];
            const randomFoodIndex = Math.floor(Math.random() * foodList.length);

            message = `오늘은 [${foodList[randomFoodIndex]}]이/가 어떨까요?`;
            msg.reply(message);
        }

        if(stringMatchResult(featString, ["ㅁㅎㅈ", "뭐하지"])) {
            const activityList = [
                "산책하기", "조깅하기", "달리기", "등산하기", "자전거타기",
                "수영하기", "요가하기", "필라테스하기", "헬스하기", "스트레칭하기",
                "줄넘기하기", "배드민턴치기", "테니스치기", "탁구치기", "농구하기",
                "축구하기", "야구하기", "배구하기", "골프치기", "볼링치기",
                "당구치기", "스쿼시하기", "클라이밍하기", "서핑하기", "스키타기",
                "스노보드타기", "스케이트타기", "인라인스케이트타기", "킥보드타기", "스쿠터타기",
                "독서하기", "만화책보기", "웹툰보기", "소설읽기", "시읽기",
                "에세이읽기", "자기계발서읽기", "잡지보기", "신문읽기", "글쓰기",
                "일기쓰기", "블로그쓰기", "시쓰기", "소설쓰기", "편지쓰기",
                "그림그리기", "수채화그리기", "유화그리기", "아크릴화그리기", "드로잉하기",
                "스케치하기", "만화그리기", "캐리커처그리기", "캘리그라피하기", "서예하기",
                "색칠하기", "페인팅하기", "사진찍기", "사진편집하기", "영상촬영하기",
                "영상편집하기", "유튜브보기", "넷플릭스보기", "영화보기", "드라마보기",
                "예능보기", "다큐멘터리보기", "애니메이션보기", "뮤직비디오보기", "라이브방송보기",
                "음악듣기", "노래부르기", "노래방가기", "악기연주하기", "기타치기",
                "피아노치기", "드럼치기", "바이올린켜기", "첼로켜기", "플루트불기",
                "색소폰불기", "트럼펫불기", "하모니카불기", "우쿨렐레치기", "베이스치기",
                "작곡하기", "편곡하기", "랩하기", "비트메이킹하기", "믹싱하기",
                "춤추기", "방송댄스추기", "스트릿댄스추기", "힙합댄스추기", "왈츠추기",
                "탱고추기", "살사추기", "발레하기", "현대무용하기", "한국무용하기",
                "게임하기", "메이플하기", "롤하기", "배그하기", "피파하기",
                "오버워치하기", "LOL하기", "스타하기", "마크하기", "포켓몬하기",
                "닌텐도하기", "플스하기", "Xbox하기", "PC방가기", "보드게임하기",
                "체스두기", "바둑두기", "장기두기", "오목두기", "카드게임하기",
                "포커하기", "화투치기", "고스톱치기", "윷놀이하기", "퍼즐맞추기",
                "직소퍼즐하기", "레고조립하기", "프라모델만들기", "종이접기하기", "공예하기",
                "뜨개질하기", "자수하기", "십자수하기", "퀼트하기", "패치워크하기",
                "DIY하기", "목공하기", "도자기만들기", "비누만들기", "양초만들기",
                "향수만들기", "요리하기", "베이킹하기", "제빵하기", "디저트만들기",
                "케이크만들기", "쿠키굽기", "빵굽기", "파스타만들기", "피자만들기",
                "샐러드만들기", "칵테일만들기", "커피내리기", "라떼아트하기", "홍차우려내기",
                "카페가기", "맛집가기", "베이커리가기", "디저트카페가기", "브런치카페가기",
                "쇼핑하기", "윈도우쇼핑하기", "온라인쇼핑하기", "백화점가기", "아울렛가기",
                "편의점가기", "마트가기", "시장가기", "벼룩시장가기", "중고거래하기",
                "여행하기", "국내여행하기", "해외여행하기", "당일치기여행하기", "캠핑하기",
                "글램핑하기", "차박하기", "백패킹하기", "트레킹하기", "섬여행하기",
                "온천가기", "찜질방가기", "사우나하기", "스파가기", "마사지받기",
                "네일아트하기", "페디큐어하기", "헤어하기", "염색하기", "파마하기",
                "화장하기", "메이크업하기", "스킨케어하기", "팩하기", "목욕하기",
                "반신욕하기", "족욕하기", "명상하기", "참선하기", "기도하기",
                "교회가기", "성당가기", "절가기", "템플스테이하기", "봉사활동하기",
                "헌혈하기", "기부하기", "재능기부하기", "환경보호하기", "플로깅하기",
                "청소하기", "대청소하기", "정리정돈하기", "빨래하기", "설거지하기",
                "이불빨래하기", "옷정리하기", "방청소하기", "화장실청소하기", "주방청소하기",
                "미니멀라이프하기", "단순하게살기", "미니멀리즘실천하기", "버리기", "기록하기",
                "가계부쓰기", "다이어리쓰기", "플래너작성하기", "스케줄관리하기", "시간관리하기",
                "목표세우기", "계획세우기", "버킷리스트작성하기", "자기분석하기", "회고하기",
                "공부하기", "독학하기", "인강듣기", "강의듣기", "온라인강의듣기",
                "외국어공부하기", "영어공부하기", "일본어공부하기", "중국어공부하기", "스페인어공부하기",
                "프랑스어공부하기", "독일어공부하기", "이탈리아어공부하기", "코딩공부하기", "프로그래밍하기",
                "파이썬공부하기", "자바공부하기", "자바스크립트공부하기", "웹개발공부하기", "앱개발공부하기",
                "디자인공부하기", "포토샵배우기", "일러스트배우기", "영상편집배우기", "3D모델링하기",
                "증권공부하기", "주식공부하기", "재테크공부하기", "경제공부하기", "투자공부하기",
                "자격증공부하기", "토익공부하기", "토플공부하기", "한자공부하기", "역사공부하기",
                "철학공부하기", "심리학공부하기", "사회학공부하기", "과학공부하기", "수학공부하기",
                "천문학공부하기", "지리공부하기", "문학공부하기", "예술공부하기", "음악이론공부하기",
                "친구만나기", "약속잡기", "데이트하기", "소개팅하기", "미팅하기",
                "동창회가기", "동문회가기", "회식가기", "송년회가기", "신년회가기",
                "워크샵가기", "세미나참석하기", "컨퍼런스가기", "박람회가기", "전시회가기",
                "미술관가기", "박물관가기", "과학관가기", "천문대가기", "수족관가기",
                "동물원가기", "식물원가기", "공연보기", "연극보기", "뮤지컬보기",
                "콘서트가기", "페스티벌가기", "영화관가기", "IMAX보기", "4DX보기",
                "클래식공연보기", "오페라보기", "발레공연보기", "마술쇼보기", "코미디쇼보기",
                "스탠드업코미디보기", "버스킹보기", "노래자랑참가하기", "오디션보기", "댄스배틀보기",
                "낚시하기", "바다낚시하기", "민물낚시하기", "루어낚시하기", "플라이낚시하기",
                "캠핑낚시하기", "야영하기", "바비큐하기", "고기굽기", "삼겹살굽기",
                "갈비굽기", "조개구이하기", "생선구이하기", "야외요리하기", "모닥불피우기",
                "별보기", "천체관측하기", "유성우보기", "일출보기", "일몰보기",
                "야경보기", "불꽃놀이보기", "드라이브하기", "야간드라이브하기", "해안도로드라이브하기",
                "카페투어하기", "맛집투어하기", "베이커리투어하기", "와이너리투어하기", "양조장투어하기",
                "공장견학하기", "농장체험하기", "목장체험하기", "과수원체험하기", "딸기따기",
                "사과따기", "포도따기", "블루베리따기", "고구마캐기", "감자캐기",
                "옥수수따기", "버섯따기", "산나물캐기", "밤줍기", "도토리줍기",
                "반려동물산책시키기", "강아지산책하기", "고양이놀아주기", "애완동물돌보기", "수조청소하기",
                "화분가꾸기", "정원가꾸기", "텃밭가꾸기", "베란다정원만들기", "다육이키우기",
                "선인장키우기", "관엽식물키우기", "허브키우기", "채소키우기", "과일나무키우기",
                "씨앗심기", "모종심기", "분갈이하기", "가지치기", "비료주기",
                "병해충관리하기", "스마트팜하기", "아쿠아포닉스하기", "수경재배하기", "버섯재배하기",
                "자원봉사하기", "멘토링하기", "튜터링하기", "재능나눔하기", "무료급식봉사하기",
                "요양원봉사하기", "보육원봉사하기", "유기견보호소봉사하기", "환경정화활동하기", "해안정화활동하기",
                "산림정화활동하기", "재활용하기", "업사이클링하기", "제로웨이스트실천하기", "친환경생활하기",
                "채식하기", "비건식하기", "클린이팅하기", "홈트레이닝하기", "맨몸운동하기",
                "플랭크하기", "윗몸일으키기", "팔굽혀펴기", "스쿼트하기", "런지하기",
                "버피테스트하기", "케틀벨운동하기", "덤벨운동하기", "밴드운동하기", "폼롤러하기",
                "근막이완하기", "마사지건사용하기", "반신욕하기", "냉온욕하기", "족욕하기",
                "찜질하기", "핫팩하기", "아이스팩하기", "물마시기", "물2리터마시기",
                "녹즙마시기", "단백질쉐이크마시기", "비타민챙겨먹기", "영양제먹기", "건강검진받기",
                "치과가기", "안과가기", "피부과가기", "한의원가기", "병원가기",
                "약먹기", "파스붙이기", "소화제먹기", "두통약먹기", "비타민C먹기",
                "오메가3먹기", "유산균먹기", "마그네슘먹기", "아연먹기", "철분제먹기",
                "주식투자하기", "코인투자하기", "부동산공부하기", "경매공부하기", "펀드가입하기",
                "적금들기", "예금가입하기", "보험가입하기", "연금가입하기", "재테크세미나듣기",
                "재무설계하기", "포트폴리오짜기", "분산투자하기", "장기투자하기", "가치투자하기",
                "차트분석하기", "재무제표보기", "기업분석하기", "뉴스보기", "경제신문읽기",
                "이력서쓰기", "자소서쓰기", "포트폴리오만들기", "면접준비하기", "취업준비하기",
                "이직준비하기", "창업준비하기", "사업계획서쓰기", "네트워킹하기", "명함교환하기",
                "세미나발표하기", "프레젠테이션준비하기", "회의준비하기", "보고서작성하기", "기획안작성하기",
                "제안서작성하기", "계약서검토하기", "법률검토하기", "특허출원하기", "상표등록하기",
                "스타포스하기", "큐브돌리기", "카르마의가위사용하기", "보스사냥하기", "몬스터파크하기",
                "메소파밍하기", "일일퀘스트하기", "주간퀘스트하기", "유니온키우기", "링크스킬올리기",
                "심볼퀘하기", "에르다스펙트럼모으기", "아케인포스올리기", "어센틱포스올리기", "레벨업하기",
                "사냥하기", "파티사냥하기", "길드사냥하기", "익스트림몬파하기", "플래그레이스하기",
                "무릉도장가기", "시드링하기", "에픽던전가기", "카오스보스잡기", "하드보스잡기",
                "노말보스잡기", "데일리보스잡기", "위클리보스잡기", "코디꾸미기", "헤어바꾸기",
                "성형하기", "염색하기", "길드원모집하기", "친구추가하기", "파티원구하기",
                "장비강화하기", "잠재능력재설정하기", "에디셔널잠재능력재설정하기", "주문의흔적사용하기", "놀라운장비강화주문서사용하기",
                "황금망치사용하기", "순백의주문서사용하기", "이노센트주문서사용하기", "카르마의가위사용하기", "실버카르마의가위사용하기",
                "헥사스탯올리기", "6차스킬강화하기", "솔에르다모으기", "크랙에르다모으기", "프래그먼트모으기",
                "이벤트참여하기", "출석체크하기", "메이플패스하기", "PC방가서메이플하기", "핫타임참여하기",
                "운동복입고운동하기", "러닝머신뛰기", "사이클링하기", "실내자전거타기", "암벽등반하기",
                "복싱하기", "킥복싱하기", "무에타이하기", "주짓수하기", "유도하기",
                "태권도하기", "검도하기", "합기도하기", "택견하기", "카포에라하기",
                "펜싱하기", "양궁하기", "사격하기", "승마하기", "골프연습하기",
                "스크린골프치기", "야구연습하기", "타석연습하기", "축구연습하기", "족구하기",
                "풋살하기", "비치발리볼하기", "비치사커하기", "프리스비하기", "얼티밋프리스비하기",
                "럭비하기", "미식축구하기", "하키하기", "아이스하키하기", "컬링하기",
                "봅슬레이하기", "루지하기", "스켈레톤하기", "피겨스케이팅하기", "쇼트트랙하기",
                "스피드스케이팅하기", "크로스컨트리하기", "바이애슬론하기", "알파인스키하기", "프리스타일스키하기",
                "노르딕복합하기", "스키점프하기", "패러글라이딩하기", "행글라이딩하기", "스카이다이빙하기",
                "번지점프하기", "집라인타기", "짚라인타기", "ATV타기", "레프팅하기",
                "카약타기", "카누타기", "래프팅하기", "수상스키타기", "웨이크보드타기",
                "제트스키타기", "윈드서핑하기", "카이트서핑하기", "요트타기", "세일링하기",
                "조정하기", "용선하기", "스쿠버다이빙하기", "프리다이빙하기", "스노클링하기",
                "패들보드하기", "SUP하기", "비치코밍하기", "조개잡기", "게잡기",
                "바지락캐기", "소라잡기", "전복따기", "미역따기", "김양식체험하기",
                "굴까기", "홍합따기", "해녀체험하기", "갯벌체험하기", "염전체험하기",
                "승마체험하기", "양떼목장가기", "알파카목장가기", "타조목장가기", "사슴농장가기",
                "곤충박물관가기", "나비축제가기", "반딧불이축제가기", "철새관찰하기", "들새관찰하기",
                "탐조하기", "야생동물관찰하기", "생태관찰하기", "숲체험하기", "산림욕하기",
                "편백숲걷기", "치유의숲걷기", "힐링숲체험하기", "숲해설듣기", "생태해설듣기",
                "자연관찰하기", "곤충채집하기", "표본만들기", "압화만들기", "드라이플라워만들기",
                "꽃꽂이하기", "플라워아트하기", "테라리움만들기", "마크라메하기", "원예치료받기",
                "아로마테라피받기", "허브티만들기", "천연비누만들기", "천연화장품만들기", "립밤만들기",
                "핸드크림만들기", "바디스크럽만들기", "배쓰밤만들기", "디퓨저만들기", "룸스프레이만들기",
                "섬유유연제만들기", "세제만들기", "친환경세제만들기", "EM발효액만들기", "퇴비만들기",
                "지렁이분변토만들기", "액비만들기", "천연살충제만들기", "천연제초제만들기", "순환농법배우기",
                "유기농배우기", "무농약재배하기", "자연농법하기", "바이오다이나믹농법하기", "퍼머컬처하기",
                "도시농업하기", "옥상텃밭가꾸기", "주말농장하기", "귀농체험하기", "귀촌체험하기",
                "농촌체험하기", "어촌체험하기", "산촌체험하기", "민박체험하기", "한옥스테이하기",
                "고택체험하기", "전통문화체험하기", "한복입기", "한복체험하기", "전통혼례체험하기",
                "전통혼례보기", "전통공연보기", "사물놀이배우기", "풍물놀이배우기", "탈춤배우기",
                "민요배우기", "판소리배우기", "가야금배우기", "거문고배우기", "해금배우기",
                "대금배우기", "피리배우기", "태평소배우기", "장구배우기", "북배우기",
                "꽹과리배우기", "징배우기", "국악배우기", "전통무용배우기", "궁중무용배우기",
                "부채춤배우기", "검무배우기", "승무배우기", "살풀이춤배우기", "태평무배우기",
                "전통주빚기", "막걸리빚기", "약주빚기", "청주빚기", "과하주빚기",
                "매실주담그기", "오미자주담그기", "복분자주담그기", "산딸기주담그기", "머루주담그기",
                "포도주만들기", "와인만들기", "홈브루잉하기", "맥주만들기", "칵테일만들기",
                "전통차배우기", "다도배우기", "다례배우기", "명상차마시기", "선다하기",
                "서당체험하기", "한문배우기", "사자소학배우기", "천자문배우기", "명심보감읽기",
                "논어읽기", "맹자읽기", "대학읽기", "중용읽기", "사서삼경읽기",
                "불교경전읽기", "성경읽기", "코란읽기", "도덕경읽기", "장자읽기",
                "주역공부하기", "사주공부하기", "명리학공부하기", "풍수지리공부하기", "관상공부하기",
                "수상공부하기", "타로배우기", "타로카드보기", "점보기", "별자리공부하기",
                "천문학배우기", "별자리찾기", "별자리관측하기", "달관측하기", "행성관측하기",
                "혜성관측하기", "유성관측하기", "일식관측하기", "월식관측하기", "천체사진찍기",
                "야경사진찍기", "인물사진찍기", "풍경사진찍기", "접사촬영하기", "매크로촬영하기",
                "타임랩스촬영하기", "슬로우모션촬영하기", "항공촬영하기", "드론촬영하기", "수중촬영하기",
                "흑백사진찍기", "필름사진찍기", "즉석사진찍기", "폴라로이드찍기", "증명사진찍기",
                "가족사진찍기", "우정사진찍기", "커플사진찍기", "셀카찍기", "인생샷찍기",
                "OOTD찍기", "데일리룩찍기", "푸드사진찍기", "제품사진찍기", "상품사진찍기",
                "사진인화하기", "사진앨범만들기", "포토북만들기", "액자만들기", "사진전시하기",
                "개인전열기", "단체전참여하기", "공모전참여하기", "사진공모전내기", "디자인공모전내기",
                "영상공모전내기", "문학공모전내기", "시공모전내기", "소설공모전내기", "수필공모전내기",
                "UCC공모전내기", "아이디어공모전내기", "발명품공모전내기", "특허공모전내기", "창업공모전내기",
                "해커톤참여하기", "코딩대회나가기", "알고리즘대회나가기", "CTF대회나가기", "AI대회나가기",
                "데이터분석대회나가기", "캐글참여하기", "깃허브활동하기", "오픈소스기여하기", "사이드프로젝트하기",
                "토이프로젝트하기", "포트폴리오사이트만들기", "개인블로그만들기", "기술블로그쓰기", "브이로그찍기",
                "유튜브채널만들기", "팟캐스트만들기", "오디오북만들기", "전자책쓰기", "킨들출판하기",
                "자가출판하기", "독립출판하기", "인디음악만들기", "음원내기", "앨범내기",
                "믹스테이프만들기", "리믹스하기", "커버곡만들기", "번안곡만들기", "작사하기",
                "랩가사쓰기", "프리스타일랩하기", "비트박스하기", "아카펠라하기", "합창하기",
                "중창하기", "독창하기", "성악배우기", "발성연습하기", "호흡연습하기",
                "무대공연하기", "버스킹하기", "길거리공연하기", "재즈바가기", "라이브클럽가기",
                "인디클럽가기", "EDM클럽가기", "하우스클럽가기", "힙합클럽가기", "레게클럽가기",
                "살사클럽가기", "스윙댄스클럽가기", "라인댄스배우기", "컨트리댄스배우기", "플라멩코배우기",
                "벨리댄스배우기", "폴댄스배우기", "재즈댄스배우기", "탭댄스배우기", "브레이킹배우기",
                "팝핑배우기", "락킹배우기", "왁킹배우기", "크럼프배우기", "하우스댄스배우기",
                "보깅배우기", "튜팅배우기", "애니메이션댄스배우기", "로봇댄스배우기", "웨이브하기",
                "아이솔레이션연습하기", "프리즈연습하기", "윈드밀연습하기", "헤드스핀연습하기", "토마스연습하기",
                "에어플레어연습하기", "비보잉배우기", "댄스배틀참여하기", "사이퍼참여하기", "잼세션하기",
                "오픈마이크참여하기", "랩배틀참여하기", "MC배틀참여하기", "DJ배우기", "디제잉하기",
                "턴테이블리즘배우기", "스크래칭배우기", "믹싱배우기", "마스터링배우기", "사운드디자인하기",
                "폴리아티스트되기", "음향효과만들기", "영화음악만들기", "게임음악만들기", "광고음악만들기",
                "BGM만들기", "OST만들기", "테마송만들기", "징글만들기", "사운드로고만들기",
                "보이스연기하기", "더빙하기", "나레이션하기", "오디오북녹음하기", "성우체험하기",
                "라디오DJ체험하기", "팟캐스트진행하기", "유튜브라이브하기", "트위치방송하기", "아프리카TV방송하기",
                "치지직방송하기", "인스타라이브하기", "틱톡찍기", "릴스찍기", "숏츠찍기",
                "쇼츠만들기", "밈만들기", "짤만들기", "GIF만들기", "스티커만들기",
                "이모티콘만들기", "캐릭터디자인하기", "로고디자인하기", "브랜드디자인하기", "패키지디자인하기",
                "타이포그래피하기", "레터링하기", "손글씨쓰기", "폰트만들기", "아이콘디자인하기",
                "UI디자인하기", "UX디자인하기", "웹디자인하기", "앱디자인하기", "게임디자인하기",
                "3D그래픽하기", "CGI작업하기", "VFX작업하기", "모션그래픽하기", "애니메이션만들기",
                "2D애니메이션하기", "스톱모션만들기", "클레이애니메이션만들기", "종이애니메이션만들기", "컷아웃애니메이션만들기",
                "로토스코핑하기", "트레이싱하기", "키프레임작업하기", "트위닝하기", "이징하기",
                "AR콘텐츠만들기", "VR콘텐츠만들기", "메타버스체험하기", "가상현실체험하기", "증강현실체험하기",
                "홀로그램체험하기", "인터랙티브아트체험하기", "미디어아트체험하기", "설치미술보기", "퍼포먼스아트보기",
                "프로젝션맵핑보기", "라이트쇼보기", "레이저쇼보기", "분수쇼보기", "불꽃쇼보기",
                "드론쇼보기", "홀로그램쇼보기", "매직아이체험하기", "착시체험관가기", "트릭아트체험하기",
                "아이스크림박물관가기", "초콜릿박물관가기", "테디베어박물관가기", "장난감박물관가기", "로봇박물관가기"
            ];
            const randomActIndex = Math.floor(Math.random() * foodList.length);

            message = `오늘은 [${foodList[randomActIndex]}]가 어떨까요?`;
            msg.reply(message);
        }

        if(stringMatchResult(featString, ["도움말", "명령어", "ㄷㅇㅁ", "ㅁㄹㅇ"])) {
            let queryString = buildQueryString(options);
            let helpData = callApi("/extra/help", queryString);

            let message = "현재 일부 기능만 사용 가능하며, 복구되지 않은 명령어를 사용하면 오류가 발생하니 양해 부탁드립니다.\n\n";
            message += helpData.resultRaw;
            msg.reply(message);
        }

    } catch (err) {
        message = "명령어 실행 결과: 실패\n\n명령어 실행에 오류가 발생했습니다. 개발자에게 메시지가 전송되었으니 나중에 다시 시도해 주세요.";
        msg.reply(message);
        bot.send("승엽[EmotionB_SY]", `${getNowDateKor()}\n${msg.room} / ${msg.author.name}\n${err}`);
        Log.e(err);
    }
}
bot.addListener(Event.MESSAGE, onMessage);

function stringMatchResult(featString, featMap) {
    for(let i = 0; i < featMap.length; i++) {
        if(featString == featMap[i]) {
            return true;
        }
    }
    return false;
}

function callApi(apiFeat, queryString) {
    let apiUrl = `${API_URL}${apiFeat}${queryString}`;

    let response = JSOUP.connect(apiUrl)
        .ignoreContentType(true)
        .header("Accept-Charset", "UTF-8")
        .postDataCharset("UTF-8")
        .get();

    return JSON.parse(response.body().text());
}

function buildQueryString() {
    let queryStringArr = [];

    for(let i = 0; i < arguments.length; i++) {
        let arg = arguments[i];
        if(arg != undefined) {
            if(Array.isArray(arg)) {
                queryStringArr = queryStringArr.concat(arg);
            } else {
                queryStringArr.push(arg);
            }
        }
    }

    let encodedArr = queryStringArr.map(function(part) {
        return encodeURIComponent(part);
    });
    return `/${encodedArr.join('/')}`;
}

function getNowDateKor() {
    let date = new Date();
    let res = `${date.getFullYear()}.${date.getMonth() + 1}.${date.getDate()} ${date.getHours()}:${date.getMinutes()}:${date.getSeconds()}`;
    return res;
}


/**
 * (string) msg.content: 메시지의 내용
 * (string) msg.room: 메시지를 받은 방 이름
 * (User) msg.author: 메시지 전송자
 * (string) msg.author.name: 메시지 전송자 이름
 * (Image) msg.author.avatar: 메시지 전송자 프로필 사진
 * (string) msg.author.avatar.getBase64()
 * (boolean) msg.isDebugRoom: 디버그룸에서 받은 메시지일 시 true
 * (boolean) msg.isGroupChat: 단체/오픈채팅 여부
 * (string) msg.packageName: 메시지를 받은 메신저의 패키지명
 * (void) msg.reply(string): 답장하기
 * (string) msg.command: 명령어 이름
 * (Array) msg.args: 명령어 인자 배열
 */

const ROOM_LIST = ["06-21", "집사 네 마리", "그녀석의 재획교실", "아케인 편안길드", "무친자들의 모임", "앙메톡"];

function onCommand(msg) {
    try {
        const command = msg.content.substring("@@".length).trim();
        const featString = command.split(/\s+/)[0];
        const options = command.split(/\s+/).slice(1);

        let message = "";

        if(featString == "공지전송") {
            let failure = [];
            for(let roomName of ROOM_LIST) {
                if(!bot.canReply(roomName)) {
                    failure.push(roomName);
                }
                bot.send(roomName, options.join(" "));
            }
            message += "공지 전송 완료.\n";
            if(failure.length > 0) {
                message += `아래 톡방은 전송이 불가능합니다:\n${failure.join(" / ")}`;
            }
            bot.send("승엽[EmotionB_SY]", message);
        }
    } catch (e) {
        bot.send("승엽[EmotionB_SY]", getNowDateKor());
        bot.send("승엽[EmotionB_SY]", "Command 실행 실패");
        Log.e(e);
    }
}
bot.setCommandPrefix("@@"); //@@로 시작하는 메시지를 command로 판단
bot.addListener(Event.COMMAND, onCommand);


function onCreate(savedInstanceState, activity) {
  var textView = new android.widget.TextView(activity);
  textView.setText("Hello, World!");
  textView.setTextColor(android.graphics.Color.DKGRAY);
  activity.setContentView(textView);
}

function onStart(activity) {}

function onResume(activity) {}

function onPause(activity) {}

function onStop(activity) {}

function onRestart(activity) {}

function onDestroy(activity) {}

function onBackPressed(activity) {}

bot.addListener(Event.Activity.CREATE, onCreate);
bot.addListener(Event.Activity.START, onStart);
bot.addListener(Event.Activity.RESUME, onResume);
bot.addListener(Event.Activity.PAUSE, onPause);
bot.addListener(Event.Activity.STOP, onStop);
bot.addListener(Event.Activity.RESTART, onRestart);
bot.addListener(Event.Activity.DESTROY, onDestroy);
bot.addListener(Event.Activity.BACK_PRESSED, onBackPressed);